name: Build, unittest and publish
on: [push]
env:
  PYTHON_VERSION: "3.10"

jobs:
  # unittests:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3
  #     - name: Set up Python ${{ env.PYTHON_VERSION }}
  #       uses: actions/setup-python@v4
  #       with:
  #         python-version: ${{ env.PYTHON_VERSION }}
  #         cache: 'pip'
  #     - name: Install dependencies
  #       run: |
  #         python -m pip install --upgrade pip
  #         if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
  #     - name: Test with unittest
  #       run: |
  #         python -m unittest
  package-and-publish:
    # if: github.ref == 'refs/heads/master'
    # needs: unittests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      - name: Build package
        run: |
          pip install build
          python -m build
      - name: Publish package
        env:
          AZURE_ARTIFACTS_READWRITE_TOKEN: ${{ secrets.AZURE_ARTIFACTS_READWRITE_TOKEN }}
        run: |
          pip install twine
          python -m twine upload \
            --repository-url https://pkgs.dev.azure.com/PimMostert0588/BayesianNetwork/_packaging/BayesianNetwork/pypi/upload/ \
            --password $AZURE_ARTIFACTS_READWRITE_TOKEN \
            ./dist/*          
        
        # uses: pypa/gh-action-pypi-publish@27b31702a0e7fc50959f5ad993c78deac1bdfc29
        # with:
        #   user: __token__
        #   password: ${{ secrets.PYPI_API_TOKEN }}  
      
